<div
  class="max-w-md mx-auto dark:bg-gray-700 bg-white mt-4 rounded-lg shadow-sm"
>
  <div class="p-6">
    <h2
      class="text-xs font-medium text-gray-500 dark:text-white uppercase tracking-wide mb-4"
    >
      Mis Familias
    </h2>

    @if (familiasUsuario?.length === 0) {
    <div class="text-sm text-gray-500 dark:text-gray-300">
      No perteneces a ninguna familia.
    </div>
    } @else { @for (familia of familiasUsuario; track familia) {
    <div
      class="flex justify-between items-center text-sm text-gray-800 dark:text-white mb-2"
      [class.font-bold]="familia.id === familiaActual?.id"
    >
      <span>
        {{ familia.descripcion }} ({{ familia.rol }}) @if (familia.id ===
        familiaActual?.id) {
        <span class="text-xs text-green-500 ml-1">(actual)</span>
        }
      </span>
      <div class="space-x-2">
        @if (familia.id !== familiaActual?.id) {
        <button
          (click)="cambiarAFamilia(familia.id)"
          class="text-blue-500 text-xs"
        >
          Entrar
        </button>
        }
        <button
          (click)="showMessageModal(familia)"
          class="text-red-500 text-xs"
        >
          Salir
        </button>
      </div>
    </div>
    } }
  </div>

  <div class="p-6 border-t border-gray-300">
    <h2
      class="text-xs font-medium text-gray-500 dark:text-white uppercase tracking-wide mb-4"
    >
      Invitaciones que has recibido
    </h2>

    @if (invitacionesRecibidas?.length === 0) {
    <div class="text-sm text-gray-500 dark:text-gray-300">
      No tienes invitaciones pendientes.
    </div>
    } @else { @for (invitacion of invitacionesRecibidas; track invitacion.id) {
    <div class="flex justify-between items-center mb-2">
      <span class="text-sm text-gray-800 dark:text-white">
        {{ invitacion.familyDescription }} ({{ invitacion.role }})
      </span>
      @if( !invitacion.attended) {
      <div class="space-x-2">
        <button
          (click)="aceptarInvitacion(invitacion.id)"
          class="text-green-500 text-xs"
        >
          Aceptar
        </button>
        <button
          (click)="rechazarInvitacion(invitacion.id)"
          class="text-red-500 text-xs"
        >
          Rechazar
        </button>
      </div>
      } @else {
      <span class="text-xs text-green-500 dark:text-green-400">
        {{ invitacion.accepted ? "Aceptada" : "Rechazada" }}
      </span>
      }
    </div>
    } }
  </div>

  <div class="p-6 border-t border-gray-300">
    <div class="flex justify-between items-center mb-4 align-middle">
      <h2
        class="text-xs font-medium text-gray-500 dark:text-white uppercase tracking-wide"
      >
        Invitaciones que has enviado
      </h2>
      @if (familiaActual?.rol === 'admin') {
      <div class="flex justify-center align-middle">
        <p-button
          (click)="openInvitacionModal()"
          class="flex items-center gap-2 dark:border-1"
        >
          <i class="pi pi-user-plus text-sm"></i>
          +
        </p-button>
      </div>
      }
    </div>

    @if (invitacionesEnviadas?.length === 0) {
    <div class="text-sm text-gray-500 dark:text-gray-300">
      No has enviado invitaciones.
    </div>
    } @else { @for (invitacion of invitacionesEnviadas; track invitacion.id) {
    <div class="text-sm text-gray-800 dark:text-white mb-1">
      {{ invitacion.destinationEmail }} ({{ invitacion.role }}) - @if
      (!invitacion.attended) { Enviada } @else {
      {{ invitacion.accepted ? "Aceptada" : "Rechazada" }}
      }
    </div>
    } }
  </div>
  @if(messageModalVisible) {
  <app-message-modal
    [message]="'¿Estás seguro de que deseas salir de la familia ' + (familiaASalirDescripcion || '') + '?'"
    [buttonText]="'Salir'"
    (cerrar)="closeMessageModal()"
    (button)="salirDeFamilia(familiaASalir || 0)"
  ></app-message-modal>
  }

  @if (showInvitacionModal) {
  <app-family-form
    (cerrar)="closeInvitacionModal()"
    (guardar)="enviarInvitacion($event)"
  ></app-family-form>

  }
</div>
