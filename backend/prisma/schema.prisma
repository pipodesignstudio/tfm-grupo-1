generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model actividades {
  id                  Int              @id @default(autoincrement())
  rutina_id           Int
  ninos_id            Int
  titulo              String?          @db.VarChar(100)
  descripcion         String?          @db.Text
  dia_semana          Int?             @db.UnsignedTinyInt
  hora_inicio         DateTime?        @db.Time(0)
  hora_fin            DateTime?        @db.Time(0)
  color               String?          @db.VarChar(45)
  tipo                actividades_tipo
  ubicacion           Json?
  usuario_responsable Int?
  rutinas             rutinas          @relation(fields: [rutina_id], references: [id], onDelete: Cascade, map: "fk_actividad_rutina")
  ninos               ninos            @relation(fields: [ninos_id], references: [id], onDelete: Cascade, map: "fk_actividades_ninos1")
  recordatorios       recordatorios[]

  @@index([rutina_id], map: "fk_actividad_rutina")
  @@index([ninos_id], map: "fk_actividades_ninos1_idx")
}

model alergias {
  id       Int    @id @default(autoincrement())
  ninos_id Int
  nombre   String @db.VarChar(100)
  ninos    ninos  @relation(fields: [ninos_id], references: [id], onDelete: Cascade, map: "fk_alergias_ninos1")

  @@index([ninos_id], map: "fk_alergias_ninos1_idx")
}

model familia {
  id                         Int                          @id @default(autoincrement())
  descripcion                String?                      @db.Text
  familia_usuarios           familia_usuarios[]
  invitacion_usuario_familia invitacion_usuario_familia[]
}

model familia_usuarios {
  familia_id  Int
  usuarios_id Int
  rol         familia_usuarios_rol
  familia     familia              @relation(fields: [familia_id], references: [id], onDelete: Cascade, map: "fk_familia_usuarios_familia1")
  usuarios    usuarios             @relation(fields: [usuarios_id], references: [id], onDelete: Cascade, map: "fk_familia_usuarios_usuarios1")

  @@id([familia_id, usuarios_id])
  @@index([familia_id], map: "fk_familia_usuarios_familia_idx")
  @@index([usuarios_id], map: "fk_familia_usuarios_usuarios_idx")
}

model ninos {
  id                      Int                  @id @default(autoincrement())
  perfiles_aprendizaje_id Int
  nombre                  String               @db.VarChar(100)
  apellido                String               @db.VarChar(100)
  img_perfil              Bytes?               @db.MediumBlob
  fecha_nacimiento        DateTime             @db.Date
  descripcion             String?              @db.Text
  genero                  String?              @db.VarChar(45)
  peso                    Int?
  altura                  Int?
  actividades             actividades[]
  alergias                alergias[]
  perfiles_aprendizaje    perfiles_aprendizaje @relation(fields: [perfiles_aprendizaje_id], references: [id], map: "fk_ninos_perfiles_aprendizaje1")
  notas                   notas[]
  rutinas                 rutinas[]

  @@index([perfiles_aprendizaje_id], map: "fk_ninos_perfiles_aprendizaje1_idx")
}

model notas {
  id             Int      @id @default(autoincrement())
  ninos_id       Int
  titulo         String?  @db.VarChar(45)
  texto          String?  @db.Text
  fecha_creacion DateTime @default(now()) @db.Timestamp(0)
  ninos          ninos    @relation(fields: [ninos_id], references: [id], onDelete: Cascade, map: "fk_notas_ninos1")

  @@index([ninos_id], map: "fk_notas_ninos1_idx")
}

model objetivos {
  id         Int     @id @default(autoincrement())
  rutinas_id Int
  nombre     String  @db.VarChar(45)
  color      String? @db.VarChar(45)
  tipo       String? @db.VarChar(45)
  rutinas    rutinas @relation(fields: [rutinas_id], references: [id], onDelete: Cascade, map: "fk_objetivos_rutinas1")

  @@index([rutinas_id], map: "fk_objetivos_rutinas1_idx")
}

model perfiles_aprendizaje {
  id          Int     @id @default(autoincrement())
  nombre      String  @db.VarChar(100)
  descripcion String? @db.Text
  ninos       ninos[]
}

model recordatorios {
  id           Int                        @id @default(autoincrement())
  actividad_id Int
  periodicidad recordatorios_periodicidad @default(dbgenerated("(_latin1\\'Daily\\')"))
  activo       Boolean                    @default(true)
  utlimo_envio DateTime?                  @db.Timestamp(0)
  actividades  actividades                @relation(fields: [actividad_id], references: [id], onDelete: Cascade, map: "fk_recordatorio_actividad")

  @@index([actividad_id], map: "fk_recordatorio_actividad")
}

model rutinas {
  id             Int           @id @default(autoincrement())
  ninos_id       Int
  nombre         String        @db.VarChar(100)
  descripcion    String?       @db.Text
  fecha_creacion DateTime      @default(now()) @db.Timestamp(0)
  frecuencia     Json?
  fecha_fin      DateTime?     @db.Date
  actividades    actividades[]
  objetivos      objetivos[]
  ninos          ninos         @relation(fields: [ninos_id], references: [id], onDelete: Cascade, map: "fk_rutinas_ninos1")

  @@index([ninos_id], map: "fk_rutinas_ninos1_idx")
}

model usuarios {
  id               Int                @id @default(autoincrement())
  nombre           String?            @db.VarChar(100)
  apellido         String?            @db.VarChar(100)
  nick             String             @unique(map: "nick") @db.VarChar(45)
  img_perfil       Bytes?             @db.MediumBlob
  email            String             @unique(map: "email") @db.VarChar(255)
  contrasena       String             @db.VarChar(255)
  primera_sesion   Boolean            @default(true)
  fecha_creacion   DateTime           @default(now()) @db.Timestamp(0)
  borrado          Boolean            @default(false)
  email_verificado Boolean            @default(false)
  familia_usuarios familia_usuarios[]
}

model invitacion_usuario_familia {
  id                 Int                            @id @default(autoincrement())
  familia_id         Int
  usuario_emisor     Int
  email_destinatario String                         @db.VarChar(255)
  rol                invitacion_usuario_familia_rol
  atentido           Boolean                        @default(false)
  aceptado           Boolean                        @default(false)
  fecha_envio        DateTime                       @default(now()) @db.Timestamp(0)
  familia            familia                        @relation(fields: [familia_id], references: [id], onDelete: Cascade, map: "fk_invitacion_usuario_familia_familia1")

  @@index([familia_id], map: "fk_invitacion_usuario_familia_familia1_idx")
}

enum familia_usuarios_rol {
  admin
  cuidador
  nino
}

enum actividades_tipo {
  Tarea
  Evento
  Habito
}

enum recordatorios_periodicidad {
  Daily
  Weekly
  Monthly
}

enum invitacion_usuario_familia_rol {
  admin
  cuidador
  nino
}
